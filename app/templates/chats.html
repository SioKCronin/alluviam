{% extends "layout.html" %}

{% block title %}Alluvium{% endblock %}

{% block body %}

<div class="row">
  <form class="col s12" id="chat-form">
    <div class="row">
      <div class="input-field col s6">
        <i class="material-icons prefix">mode_edit</i>
        <input id="message" class="materialize-input" placeholder="Query term">
      </div>
      <div class="input-field col s3">
        <button class="btn waves-effect waves-light" type="submit" name="action">Send
          <i class="material-icons right">send</i>
        </button>
      </div>
    </div>
  </form>
</div>
<h5>Active query</h5>
<ul id="chat-list" class="collection">
    {% for chat in chats %}
    <li class="collection-item">{{ chat.message }}</li>
    {% endfor %}
</ul>
<h5>Results</h5>
<script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.8.1/axios.min.js"></script>
<script>

var chatForm = document.getElementById('chat-form');
var messageInput = document.getElementById('message');
var chatList = document.getElementById('chat-list');

var socket = io.connect('http://' + document.domain + ':' + location.port);

// event handler for receiving a 'new_chat' event on the socket.
socket.on('new_chat', function(data) {
  chatList.innerHTML = '<li class="collection-item">'+data.new_val.message+'</li>' 
  //+ chatList.innerHTML;
});

// event handler for when a user clicks "Send" on the page
chatForm.addEventListener('submit', function(e) {
  e.preventDefault();
  var request = axios.post('/chats/', {
    message: messageInput.value
  });
  request.then(function(data) {
    console.log(data);
  })
  messageInput.value = "";
});
</script>




{% endblock %}
